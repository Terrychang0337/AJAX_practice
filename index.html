<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJAX</title>
</head>

<style>
    img {
        width: 100%;
    }

    #shoplist {
        display: flex;
        list-style: none;
        padding: 0;

    }

    #shoplist li {
        flex: 1;
        cursor: pointer;
        border: 1px solid black;
        padding: 10px;
        margin: 15px;
        font-size: 12px;
        border-radius: 5px;

    }

    #shoplist li:hover {
        background-color: #f5f5f5;
        box-shadow: 0px 0px 20px rgb(0, 0, 0, 0.2);

    }

    #shoplist img {
        mix-blend-mode: multiply;
    }
</style>

<body>


    <h2>請選擇你的鞋子</h2>
    <hr>
    <ul id="shoplist">

    </ul>
    <h3>你選擇了</h3>
    <p class="selectinfo"></p>
    <button onclick="downloadList()">載入清單</button>



    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script>

        var cataurl = "https://2017.awiclass.monoame.com/api/demo/shop";
        var imgurl = "https://2017.awiclass.monoame.com";
        var items = [];
        function downloadList() {

            $.ajax({
                url: cataurl,
                success: function (res) {
                    console.log(res);
                    // 把成功抓取回來的陣列存入變數items
                    items = res;
                    updateList();
                },
                error: function () {
                    console.log("載入失敗");
                }

            })

        }

        function updateList() {

            $('ul#shoplist').html("");
            items.forEach(function (item) {
                var item = `
                    <li data-id="${item.id}">
                        <img src="${imgurl}${item.img}">
                        <h3>${item.name}</h3>
                    </li>
                `
                var itemEl = $(item);

                itemEl.click(function () {
                    var selectedId = $(this).attr("data-id");

                    console.log(selectedId)
                    updateSelect(selectedId);
                })

                $('ul#shoplist').append(itemEl);
                console.log(item.name)

            })

        }

        function updateSelect(id) {
            $('.selectinfo').html("");
            $.ajax({
                url: cataurl + "/" + id,
                success: function (res) {
                    var content = `
                    <ul>
                        <li>名字:${res.name} </li>
                        <li>價格:${res.price} </li>
                        <li>顏色:${res.color} </li>
                        <li>尚有存貨:${res.count} </li>
                        <li>描述:${res.description} </li>
                    </ul> 
                    `
                    console.log(res)

                    // JSON.stringify()  物件轉換成文字
                    // $('.selectinfo').text(JSON.stringify(res));
                    $('.selectinfo').append(content);

                }




            })
        }



    </script>
</body>

</html>